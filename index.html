<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7 Zwerge Presentation - Final</title>
    
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load Icon Library (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- 3. Load Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- 4. Custom Fonts -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lato:ital,wght@0,300;0,400;0,700;1,400&display=swap');
    </style>
    
    <!-- 5. Tailwind Config for Fonts -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              serif: ['Cinzel', 'serif'],
              sans: ['Lato', 'sans-serif'],
            }
          }
        }
      }
    </script>

    <!-- 6. Custom CSS Animations -->
    <style>
        @layer utilities {
          .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
          }
          
          @keyframes slide-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
          }
          .animate-slide-in { animation: slide-in 0.6s ease-out forwards; }

          @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
          }
          .animate-fade-in-up { animation: fade-in-up 0.5s ease-out forwards; }

          @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
          }
          .animate-float { animation: float 3s ease-in-out infinite; }
          
          @keyframes shine {
            0% { background-position: 200% center; }
            100% { background-position: -200% center; }
          }
          .animate-shine {
            background-size: 200% auto;
            animation: shine 4s linear infinite;
          }

          @keyframes pop-in {
            0% { opacity: 0; transform: scale(0.5); }
            70% { transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
          }
          .animate-pop-in { animation: pop-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

          @keyframes cinematic-breathe {
            0% { 
              transform: scale(1.05) translateX(0%);
            }
            25% { 
              transform: scale(1.08) translateX(-2%);
            }
            50% { 
              transform: scale(1.10) translateX(0%);
            }
            75% { 
              transform: scale(1.08) translateX(2%);
            }
            100% { 
              transform: scale(1.05) translateX(0%);
            }
          }
          .animate-cinematic-breathe { 
            animation: cinematic-breathe 60s ease-in-out infinite;
          }

          @keyframes word-fade-in {
            from { 
              opacity: 0; 
              transform: translateY(5px);
            }
            to { 
              opacity: 1; 
              transform: translateY(0);
            }
          }
          .word-fade-in {
            display: inline-block;
            opacity: 0;
            animation: word-fade-in 0.3s ease-out forwards;
          }

          .delay-100 { animation-delay: 100ms; }
          .delay-200 { animation-delay: 200ms; }
          .delay-300 { animation-delay: 300ms; }
          .delay-400 { animation-delay: 400ms; }
          .delay-500 { animation-delay: 500ms; }
          .delay-600 { animation-delay: 600ms; }
          .delay-700 { animation-delay: 700ms; }
          .delay-800 { animation-delay: 800ms; }
          .delay-1000 { animation-delay: 1000ms; }
        }

        /* Responsive Improvements */
        @media (max-width: 640px) {
          /* Mobile-specific styles */
          .animate-cinematic-breathe {
            animation: none;
            transform: scale(1.1);
          }
        }

        /* Safe area for notched phones */
        @supports (padding: env(safe-area-inset-bottom)) {
          body {
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            padding-bottom: env(safe-area-inset-bottom);
          }
        }

        /* Prevent text overflow */
        .break-words {
          word-wrap: break-word;
          overflow-wrap: break-word;
          hyphens: auto;
        }

        /* Smooth scrolling */
        html {
          scroll-behavior: smooth;
        }

        /* Better touch targets for mobile */
        @media (max-width: 768px) {
          button, [role="button"] {
            min-height: 44px;
            min-width: 44px;
          }
        }

        /* Music Toggle Button */
        #music-toggle {
          position: fixed;
          bottom: 20px;
          right: 20px;
          z-index: 10000;
          width: 48px;
          height: 48px;
          border-radius: 50%;
          border: 2px solid rgba(217, 159, 74, 0.5);
          background: rgba(42, 36, 30, 0.85);
          backdrop-filter: blur(8px);
          color: #d4a855;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }
        #music-toggle:hover {
          background: rgba(60, 50, 38, 0.95);
          border-color: rgba(217, 159, 74, 0.8);
          transform: scale(1.1);
          box-shadow: 0 4px 20px rgba(217, 159, 74, 0.3);
        }
        #music-toggle:active {
          transform: scale(0.95);
        }
        #music-toggle .bar {
          display: inline-block;
          width: 3px;
          margin: 0 1.5px;
          border-radius: 2px;
          background: currentColor;
          transition: height 0.2s ease;
        }
        #music-toggle.playing .bar {
          animation: music-bars 0.8s ease-in-out infinite alternate;
        }
        #music-toggle.playing .bar:nth-child(1) { animation-delay: 0s; }
        #music-toggle.playing .bar:nth-child(2) { animation-delay: 0.15s; }
        #music-toggle.playing .bar:nth-child(3) { animation-delay: 0.3s; }
        #music-toggle.playing .bar:nth-child(4) { animation-delay: 0.1s; }
        #music-toggle:not(.playing) .bar {
          height: 4px !important;
        }
        #music-toggle .bar:nth-child(1) { height: 6px; }
        #music-toggle .bar:nth-child(2) { height: 12px; }
        #music-toggle .bar:nth-child(3) { height: 8px; }
        #music-toggle .bar:nth-child(4) { height: 14px; }
        @keyframes music-bars {
          0%   { height: 4px; }
          100% { height: 18px; }
        }
    </style>
</head>
<body class="bg-stone-900 text-white overflow-hidden">
    <div id="root"></div>

    <!-- Background Music -->
    <audio id="bg-music" loop preload="auto">
      <source src="luis_humanoide-middle-earth-fantasy-music-inspired-by-lord-of-the-rings-261464.mp3" type="audio/mpeg">
    </audio>

    <!-- Music Toggle Button -->
    <button id="music-toggle" aria-label="Toggle music" title="Toggle music">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>

    <!-- 7. Application Logic -->
    <script>
        // --- DATA ---
        const presentationData = [
          {
            id: 1,
            question: "How does schema theory help explain differences in how audiences interpret fairy tales?",
            answer: "Schema theory helps explain that reading isn’t neutral — we bring culturally shaped mental frameworks with us every time we read. Those schemata influence how we judge characters, understand conflict, and fill in missing details. So when two audiences interpret the same fairy tale differently, it’s not random. They’re building different situation models based on what their culture has taught them to expect.",
            dwarfs: ['sunny'], 
            theme: "amber"
          },
          {
            id: 2,
            question: "How does 7 Zwerge challenge traditional fairy tale heroism?",
            answer: "What I find interesting about 7 Zwerge is that it deliberately undercuts traditional heroism. Instead of confident, morally clear characters, we get awkward, insecure dwarfs who struggle socially. The parody exaggerates fairy tale conventions and makes us question what we usually accept as heroic. It shows that heroism isn’t fixed — it can be reshaped or even mocked depending on cultural context.",
            dwarfs: ['bubi', 'tschakko'], 
            theme: "red"
          },
          {
            id: 3,
            question: "How does the individualism vs. collectivism framework apply to character interpretation?",
            answer: "The article suggests that Western audiences tend to admire independence and initiative, while East Asian audiences may prioritize harmony and social responsibility. That means what counts as a ‘good’ character isn’t universal — it depends on cultural values. So when audiences disagree about a character’s actions, they may actually be applying different cultural standards of morality.",
            dwarfs: ['cookie', 'ralfie'], 
            theme: "emerald"
          },
          {
            id: 4,
            question: "How does culture influence inference-making in stories?",
            answer: "One of the most compelling findings in the study is that cultural differences affected inference-making, not just preferences. Participants interpreted motivation, causality, and even time and space differently. That suggests culture shapes the deeper cognitive processes happening during reading. It’s not just about liking one character more — it’s about constructing meaning differently.",
            dwarfs: ['cloudy'], 
            theme: "sky"
          },
          {
            id: 5,
            question: "What larger claim does the article make about stories and reality?",
            answer: "The article ultimately argues that stories are part of how we create reality. If interpretation is guided by cultural frameworks, then meaning itself is culturally structured. That makes this study feel bigger than just fairy tales — it’s really about how culture shapes the way we understand the world.",
            dwarfs: ['speedy'], 
            theme: "violet"
          }
        ];

        const dwarfConfig = {
          bubi: { icon: 'Smile', color: 'bg-red-500', text: 'Bubi', desc: 'The Innocent Hero' },
          tschakko: { icon: 'Shield', color: 'bg-stone-600', text: 'Tschakko', desc: 'The Tough Guy' },
          sunny: { icon: 'Sun', color: 'bg-amber-400', text: 'Sunny', desc: 'The Wise One' },
          cloudy: { icon: 'Cloud', color: 'bg-sky-400', text: 'Cloudy', desc: 'The Dreamer' },
          cookie: { icon: 'Utensils', color: 'bg-orange-500', text: 'Cookie', desc: 'The Cook' },
          speedy: { icon: 'Zap', color: 'bg-yellow-300', text: 'Speedy', desc: 'The Fast One' },
          ralfie: { icon: 'Frown', color: 'bg-indigo-500', text: 'Ralfie', desc: 'The Skeptic' },
        };

        const themeColors = {
          amber: { gem: 'text-amber-400', button: 'bg-amber-600 hover:bg-amber-500', border: 'border-amber-500/30' },
          red: { gem: 'text-red-500', button: 'bg-red-700 hover:bg-red-600', border: 'border-red-500/30' },
          emerald: { gem: 'text-emerald-400', button: 'bg-emerald-700 hover:bg-emerald-600', border: 'border-emerald-500/30' },
          sky: { gem: 'text-sky-400', button: 'bg-sky-600 hover:bg-sky-500', border: 'border-sky-500/30' },
          violet: { gem: 'text-violet-400', button: 'bg-violet-600 hover:bg-violet-500', border: 'border-violet-500/30' },
          neutral: { gem: 'text-stone-300', button: 'bg-stone-600 hover:bg-stone-500', border: 'border-stone-500/30' }
        };

        // --- STATE ---
        let currentSlideIndex = 0;
        let isRevealed = false;
        let isComplete = false;

        // --- DOM ELEMENTS ---
        const root = document.getElementById('root');

        // --- SOUND EFFECTS SYSTEM ---
        const soundEffects = {
          dwarfHover: 'https://example.com/sounds/wooden-pop.mp3', // Soft wooden pop sound
          gemstoneClick: 'https://example.com/sounds/magical-chime.mp3', // Magical chime sound
          confettiExplosion: 'https://example.com/sounds/tada-fanfare.mp3' // Ta-da fanfare sound
        };

        // Audio cache to prevent reloading
        const audioCache = {};

        function playSound(type) {
          const soundUrl = soundEffects[type];
          
          if (!soundUrl) {
            console.warn(`Sound type "${type}" not found`);
            return;
          }

          // Check if audio is already cached
          if (!audioCache[type]) {
            audioCache[type] = new Audio(soundUrl);
            audioCache[type].volume = 0.5; // Set default volume to 50%
          }

          // Clone the audio to allow overlapping sounds
          const sound = audioCache[type].cloneNode();
          
          // Play the sound
          sound.play().catch(err => {
            console.warn(`Could not play sound "${type}":`, err.message);
          });
        }

        // Add sound to dwarf hover events (will be applied when rendering)
        function attachDwarfSounds() {
          // Wait a bit for DOM to be ready
          setTimeout(() => {
            const dwarfElements = document.querySelectorAll('[data-dwarf-avatar]');
            dwarfElements.forEach(dwarf => {
              dwarf.addEventListener('mouseenter', () => {
                playSound('dwarfHover');
              });
            });
          }, 100);
        }

        // --- RENDER FUNCTIONS ---
        function initApp() {
          if (!root) return;
          root.innerHTML = '';
          
          // Create Main Container
          const container = document.createElement('div');
          container.className = "relative w-full h-screen overflow-hidden text-white font-sans selection:bg-amber-500/30 flex flex-col items-center justify-center p-4 md:p-8";
          
          // Background Layer
          const bgLayer = document.createElement('div');
          bgLayer.className = "absolute inset-0 z-0 bg-cover bg-center animate-cinematic-breathe";
          bgLayer.style.backgroundImage = `url('https://images.unsplash.com/photo-1698413703803-8cbebf165be4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxteXN0aWNhbCUyMGdlcm1hbiUyMGZvcmVzdCUyMHdpdGglMjBtb3NzeSUyMHJvY2tzJTIwYW5kJTIwc3VubGlnaHR8ZW58MXx8fHwxNzcxNDU3NDk4fDA&ixlib=rb-4.1.0&q=80&w=1920')`;
          bgLayer.style.filter = 'brightness(0.6) saturate(1.1) contrast(1.1)';
          
          // Overlay
          const overlay = document.createElement('div');
          overlay.className = "absolute inset-0 bg-stone-900/40 backdrop-blur-[1px] z-0 pointer-events-none";

          container.appendChild(bgLayer);
          container.appendChild(overlay);
          
          // Slide Container
          const slideContainer = document.createElement('div');
          slideContainer.id = "slide-container";
          slideContainer.className = "relative z-10 w-full max-w-5xl transition-all duration-500";
          slideContainer.style.transformStyle = "preserve-3d";
          
          container.appendChild(slideContainer);
          root.appendChild(container);

          renderSlide();
        }

        function renderSlide() {
          const slideContainer = document.getElementById('slide-container');
          if (!slideContainer) return;

          if (isComplete) {
            renderEndSlide(slideContainer);
            return;
          }

          const data = presentationData[currentSlideIndex];
          const theme = themeColors[data.theme] || themeColors.amber;
          const isLast = currentSlideIndex === presentationData.length - 1;

          // Generate Dwarfs HTML
          const dwarfsHtml = data.dwarfs.map(dwarfKey => {
            const config = dwarfConfig[dwarfKey];
            return `
              <div class="flex flex-col items-center gap-1 sm:gap-2 group/avatar transition-transform hover:scale-110 duration-300" data-dwarf-avatar="${dwarfKey}">
                <div class="relative">
                  <div class="absolute -top-4 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[15px] sm:border-l-[20px] border-r-[15px] sm:border-r-[20px] border-b-[22px] sm:border-b-[30px] border-l-transparent border-r-transparent ${config.color.replace('bg-', 'border-b-')} opacity-0 transition-all duration-300 group-hover/avatar:-translate-y-2 group-hover/avatar:opacity-100 blur-sm"></div>
                  <div class="${config.color} rounded-full flex items-center justify-center shadow-[0_4px_0_rgba(0,0,0,0.3)] border-2 sm:border-4 border-white/20 relative z-10 w-10 h-10 sm:w-12 sm:h-12 md:w-16 md:h-16">
                    <i data-lucide="${config.icon}" class="text-white w-5 h-5 sm:w-6 sm:h-6 md:w-8 md:h-8"></i>
                  </div>
                </div>
                <div class="flex flex-col items-center relative">
                  <span class="text-white font-serif font-bold text-[10px] sm:text-xs md:text-sm tracking-wide drop-shadow-md bg-stone-900/60 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full backdrop-blur-sm border border-stone-500/30">
                    ${config.text}
                  </span>
                  <span class="absolute top-full mt-2 text-xs text-amber-200 opacity-0 group-hover/avatar:opacity-100 transition-opacity bg-black/80 px-2 py-1 rounded pointer-events-none whitespace-nowrap z-50 hidden sm:block">
                    ${config.desc}
                  </span>
                </div>
              </div>
            `;
          }).join('');

          // Generate Content HTML
          const contentHtml = `
            <div class="bg-[#2a241e]/95 border-2 border-[#5c4d3c] rounded-lg shadow-[0_20px_50px_rgba(0,0,0,0.6)] overflow-hidden p-4 sm:p-6 md:p-12 min-h-[50vh] sm:min-h-[60vh] flex flex-col animate-slide-in max-h-[90vh] overflow-y-auto">
              
              <!-- Decorative Corners - Hidden on very small screens -->
              <div class="hidden sm:block absolute top-3 left-3 w-4 h-4 bg-[#8b7355] rounded-full shadow-inner border border-[#3e3428]"></div>
              <div class="hidden sm:block absolute top-3 right-3 w-4 h-4 bg-[#8b7355] rounded-full shadow-inner border border-[#3e3428]"></div>
              <div class="hidden sm:block absolute bottom-3 left-3 w-4 h-4 bg-[#8b7355] rounded-full shadow-inner border border-[#3e3428]"></div>
              <div class="hidden sm:block absolute bottom-3 right-3 w-4 h-4 bg-[#8b7355] rounded-full shadow-inner border border-[#3e3428]"></div>
              
              <!-- Inner Border - Hidden on very small screens -->
              <div class="hidden sm:block absolute inset-4 border ${theme.border} rounded pointer-events-none"></div>

              <!-- Header -->
              <div class="relative z-10 flex flex-col items-center text-center mb-4 sm:mb-8">
                <h2 class="text-base sm:text-xl md:text-2xl text-stone-200 font-serif italic tracking-wide mb-4 sm:mb-8 drop-shadow-md px-2">
                  A Critical Analysis of "7 Zwerge – Männer allein im Wald"
                </h2>
                
                <div class="flex flex-wrap justify-center gap-3 sm:gap-6 md:gap-8 mb-4 sm:mb-8">
                  ${dwarfsHtml}
                </div>

                <h1 class="text-xl sm:text-2xl md:text-4xl font-bold text-white mb-4 sm:mb-6 leading-tight drop-shadow-lg max-w-4xl px-2 break-words">
                  ${data.question}
                </h1>
              </div>

              <!-- Content Area (Gemstone or Answer) -->
              <div class="relative z-10 flex-1 flex flex-col items-center justify-center min-h-[150px] sm:min-h-[200px]">
                
                <!-- Gemstone Container -->
                <div id="gemstone-container" class="${isRevealed ? 'hidden' : 'flex'} flex-col items-center cursor-pointer group transition-transform hover:scale-105 active:scale-95">
                  <div class="relative">
                     <div class="absolute inset-0 bg-white/5 rounded-full blur-2xl group-hover:bg-white/10 transition-colors"></div>
                     <!-- SVG Gemstone -->
                     <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="${theme.gem} drop-shadow-[0_0_15px_rgba(255,255,255,0.3)] animate-pulse-slow sm:w-[120px] sm:h-[120px]">
                       <path d="M6 3h12l4 6-10 13L2 9z"></path>
                     </svg>
                  </div>
                  <div class="mt-4 sm:mt-6 text-center">
                    <span class="inline-block px-3 sm:px-4 py-2 bg-stone-800/80 border border-stone-600 rounded text-stone-300 font-serif text-xs sm:text-sm tracking-widest uppercase group-hover:bg-stone-700 transition-colors">
                      Tap to Reveal
                    </span>
                  </div>
                </div>

                <!-- Answer Container -->
                <div id="answer-container" class="${isRevealed ? 'flex' : 'hidden'} flex-col items-center text-center px-2">
                  <p id="answer-text" class="text-base sm:text-lg md:text-2xl text-stone-200 leading-relaxed max-w-3xl mb-6 sm:mb-10 font-serif break-words" data-answer="${data.answer.replace(/"/g, '&quot;')}">
                  </p>
                  
                  <div id="next-btn-container" class="flex gap-4 opacity-0 transition-opacity duration-500">
                     <button id="next-btn" class="flex items-center gap-2 px-5 sm:px-8 py-2.5 sm:py-3 rounded-sm font-serif font-bold transition-all shadow-md uppercase tracking-wider text-sm sm:text-base ${theme.button} text-white hover:scale-105 active:scale-95 border border-white/20">
                       ${isLast ? 'Finish' : 'Next'} <i data-lucide="arrow-right" class="w-4 h-4"></i>
                     </button>
                  </div>
                </div>

              </div>

              <!-- Footer/Progress -->
              <div class="relative z-10 mt-4 sm:mt-8 flex justify-between items-center border-t border-white/10 pt-3 sm:pt-4">
                <div class="text-stone-400 font-mono text-[10px] sm:text-xs uppercase tracking-widest">
                  ${data.id} / ${presentationData.length}
                </div>
                <div class="flex gap-1">
                  ${presentationData.map((_, idx) => `
                    <div class="h-1 rounded-full transition-all duration-300 ${idx === currentSlideIndex ? `w-8 ${theme.button.split(' ')[0]}` : 'w-2 bg-stone-700'}"></div>
                  `).join('')}
                </div>
              </div>

            </div>
          `;

          slideContainer.innerHTML = contentHtml;
          
          // Re-initialize icons using Global Lucide
          lucide.createIcons({ icons: lucide.icons });

          // If answer is already revealed, show it with typewriter effect
          if (isRevealed) {
            const answerText = document.getElementById('answer-text');
            if (answerText) {
              const answer = answerText.getAttribute('data-answer');
              typewriterEffect(answer, answerText);
            }
          }

          // Attach event listeners manually
          const gemBtn = document.getElementById('gemstone-container');
          if (gemBtn) gemBtn.addEventListener('click', handleReveal);
          
          const nextBtn = document.getElementById('next-btn');
          if (nextBtn) nextBtn.addEventListener('click', handleNext);

          // Attach sound effects to dwarfs
          attachDwarfSounds();
        }

        function renderEndSlide(container) {
          // Play ta-da fanfare sound
          playSound('confettiExplosion');
          
          // --- CONFETTI FIREWORKS ---
          const duration = 5 * 1000;
          const animationEnd = Date.now() + duration;
          const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

          function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
          }

          const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();

            if (timeLeft <= 0) {
              return clearInterval(interval);
            }

            const particleCount = 50 * (timeLeft / duration);
            // Global confetti call
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
          }, 250);


          // All dwarfs together!
          const allDwarfs = Object.keys(dwarfConfig);
          const dwarfsHtml = allDwarfs.map((key, index) => {
            const config = dwarfConfig[key];
            const delayClass = `delay-${(index + 1) * 100}`;
            
            return `
              <div class="flex flex-col items-center gap-1 sm:gap-2 animate-pop-in opacity-0 ${delayClass}" style="animation-fill-mode: forwards;" data-dwarf-avatar="${key}">
                <div class="${config.color} rounded-full flex items-center justify-center shadow-[0_4px_25px_rgba(255,255,255,0.4)] border-2 sm:border-4 border-white/20 w-12 h-12 sm:w-16 sm:h-16 md:w-24 md:h-24 hover:scale-110 transition-transform cursor-default animate-float">
                  <i data-lucide="${config.icon}" class="text-white w-6 h-6 sm:w-8 sm:h-8 md:w-12 md:h-12 drop-shadow-lg"></i>
                </div>
                <span class="text-white font-serif font-bold text-[10px] sm:text-xs uppercase tracking-wider drop-shadow-md bg-stone-900/60 px-2 py-0.5 rounded-full backdrop-blur-sm border border-stone-500/30">
                  ${config.text}
                </span>
              </div>
            `;
          }).join('');

          const contentHtml = `
            <div class="bg-[#2a241e]/95 border-2 border-[#5c4d3c] rounded-lg shadow-[0_20px_50px_rgba(0,0,0,0.6)] overflow-hidden p-4 sm:p-6 md:p-12 min-h-[60vh] sm:min-h-[70vh] max-h-[95vh] overflow-y-auto flex flex-col items-center justify-center text-center animate-slide-in relative">
              
              <!-- Decorative Border - Hidden on mobile -->
              <div class="hidden sm:block absolute inset-4 border border-amber-500/20 rounded pointer-events-none"></div>

              <!-- Glowing Header -->
              <div class="mb-4 sm:mb-8 relative">
                <h1 class="text-3xl sm:text-5xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-200 via-yellow-400 to-amber-200 drop-shadow-[0_0_25px_rgba(251,191,36,0.5)] animate-shine font-serif uppercase tracking-tight leading-none mb-1 sm:mb-2">
                  Thank You
                </h1>
                <h2 class="text-lg sm:text-2xl md:text-4xl text-stone-300 font-serif italic tracking-widest uppercase opacity-80 animate-fade-in-up delay-500">
                  For Watching!
                </h2>
              </div>

              <!-- All Dwarfs Showcase -->
              <div class="flex flex-wrap justify-center gap-2 sm:gap-4 md:gap-8 mb-6 sm:mb-16 max-w-5xl">
                ${dwarfsHtml}
              </div>

              <!-- Final Message -->
              <p class="text-sm sm:text-lg md:text-xl text-stone-300 italic font-serif max-w-2xl mb-6 sm:mb-12 leading-relaxed animate-fade-in-up delay-1000 px-4">
                "Schema theory teaches us that stories are never just words on a page — they are living conversations between the text and our own cultural imaginations."
              </p>
              
              <!-- Restart Button -->
              <button id="restart-btn" class="flex items-center gap-2 sm:gap-3 px-6 sm:px-10 py-3 sm:py-4 bg-gradient-to-r from-stone-700 to-stone-600 hover:from-stone-600 hover:to-stone-500 text-white rounded-sm font-bold shadow-lg transition-transform hover:scale-105 active:scale-95 border border-stone-500/50 uppercase tracking-wider sm:tracking-widest text-sm sm:text-base group animate-fade-in-up delay-1000">
                <i data-lucide="rotate-ccw" class="w-4 h-4 sm:w-5 sm:h-5 group-hover:rotate-180 transition-transform duration-500"></i>
                Start Over
              </button>

            </div>
          `;

          container.innerHTML = contentHtml;
          
          lucide.createIcons({ icons: lucide.icons });

          const restartBtn = document.getElementById('restart-btn');
          if (restartBtn) restartBtn.addEventListener('click', handleRestart);

          // Attach sound effects to dwarfs on end slide
          attachDwarfSounds();
        }

        // --- TYPEWRITER EFFECT ---
        function typewriterEffect(text, targetElement) {
          if (!targetElement) return;
          
          // Split text into words
          const words = text.split(' ');
          targetElement.innerHTML = '';
          
          // Create spans for each word
          words.forEach((word, index) => {
            const wordSpan = document.createElement('span');
            wordSpan.className = 'word-fade-in';
            wordSpan.textContent = word;
            wordSpan.style.animationDelay = `${index * 50}ms`;
            
            targetElement.appendChild(wordSpan);
            
            // Add space after each word (except the last one)
            if (index < words.length - 1) {
              targetElement.appendChild(document.createTextNode(' '));
            }
          });
          
          // Calculate total animation time and show next button after
          const totalTime = words.length * 50 + 300; // 50ms per word + 300ms for last word animation
          setTimeout(() => {
            const nextBtnContainer = document.getElementById('next-btn-container');
            if (nextBtnContainer) {
              nextBtnContainer.style.opacity = '1';
            }
          }, totalTime);
        }

        // --- HANDLERS ---
        function handleReveal() {
          if (isRevealed) return;
          isRevealed = true;
          
          // Play magical chime sound
          playSound('gemstoneClick');
          
          const data = presentationData[currentSlideIndex];
          const theme = themeColors[data.theme] || themeColors.amber;
          const colors = ['#fbbf24', '#f59e0b', '#d97706', '#ffffff']; 
          
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: colors,
            zIndex: 100,
            shapes: ['star', 'circle']
          });

          const gemBtn = document.getElementById('gemstone-container');
          const ansContainer = document.getElementById('answer-container');
          
          if (gemBtn) gemBtn.classList.replace('flex', 'hidden');
          if (ansContainer) {
            ansContainer.classList.replace('hidden', 'flex');
            
            // Start typewriter effect for answer text
            const answerText = document.getElementById('answer-text');
            if (answerText) {
              const answer = answerText.getAttribute('data-answer');
              typewriterEffect(answer, answerText);
            }
          }
        }

        function handleNext() {
          if (currentSlideIndex < presentationData.length - 1) {
            currentSlideIndex++;
            isRevealed = false;
            renderSlide();
          } else {
            isComplete = true;
            renderSlide();
          }
        }

        function handleRestart() {
          isComplete = false;
          currentSlideIndex = 0;
          isRevealed = false;
          renderSlide();
        }

        // --- INIT ---
        initApp();

        // --- 3D TILT EFFECT ---
        function init3DTiltEffect() {
          document.addEventListener('mousemove', (e) => {
            const slideContainer = document.getElementById('slide-container');
            if (!slideContainer) return;

            // Get window dimensions
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;

            // Calculate mouse position relative to center (-1 to 1)
            const mouseX = (e.clientX / windowWidth) - 0.5;
            const mouseY = (e.clientY / windowHeight) - 0.5;

            // Calculate rotation angles (multiply by max rotation degrees)
            const maxRotation = 8; // Maximum rotation in degrees
            const rotateY = mouseX * maxRotation; // Horizontal mouse movement affects Y rotation
            const rotateX = -mouseY * maxRotation; // Vertical mouse movement affects X rotation (inverted)

            // Apply 3D transform with perspective
            slideContainer.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            slideContainer.style.transition = 'transform 0.1s ease-out';
          });

          // Reset tilt when mouse leaves the window
          document.addEventListener('mouseleave', () => {
            const slideContainer = document.getElementById('slide-container');
            if (!slideContainer) return;
            
            slideContainer.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg)';
            slideContainer.style.transition = 'transform 0.5s ease-out';
          });
        }

        // Initialize 3D tilt effect
        init3DTiltEffect();
    </script>

    <!-- 8. Sparkling Mouse Trail Effect -->
    <script>
        function createSparkleTrail() {
            // Create canvas overlay
            const canvas = document.createElement('canvas');
            canvas.style.position = 'fixed';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.pointerEvents = 'none';
            canvas.style.zIndex = '9999';
            document.body.appendChild(canvas);

            const ctx = canvas.getContext('2d');
            const particles = [];

            // Resize canvas to match window
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Particle class
            class Particle {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.size = Math.random() * 3 + 2; // 2-5px
                    this.speedX = (Math.random() - 0.5) * 2;
                    this.speedY = (Math.random() - 0.5) * 2;
                    this.life = 1.0; // full opacity
                    this.decay = Math.random() * 0.02 + 0.01; // fade speed
                    
                    // Gold color variations
                    const goldShades = [
                        { r: 255, g: 215, b: 0 },   // Gold
                        { r: 255, g: 223, b: 0 },   // Golden yellow
                        { r: 255, g: 200, b: 50 },  // Rich gold
                        { r: 255, g: 230, b: 100 }, // Light gold
                    ];
                    this.color = goldShades[Math.floor(Math.random() * goldShades.length)];
                }

                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.life -= this.decay;
                    this.size = Math.max(0, this.size - 0.05); // shrink over time
                }

                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.life;
                    
                    // Create glowing effect with gradient
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0,
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, 1)`);
                    gradient.addColorStop(0.5, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, 0.5)`);
                    gradient.addColorStop(1, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, 0)`);
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Add sparkle effect - draw a bright center
                    if (this.life > 0.5) {
                        ctx.fillStyle = `rgba(255, 255, 255, ${this.life})`;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size * 0.3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    ctx.restore();
                }
            }

            // Mouse move handler
            let lastX = 0, lastY = 0;
            document.addEventListener('mousemove', (e) => {
                const distance = Math.hypot(e.clientX - lastX, e.clientY - lastY);
                const particleCount = Math.min(Math.floor(distance / 10), 3);
                
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle(e.clientX, e.clientY));
                }
                
                lastX = e.clientX;
                lastY = e.clientY;
            });

            // Animation loop
            function animate() {
                // Clear canvas with fade effect for trails
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Update and draw particles
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    particles[i].draw();

                    // Remove dead particles
                    if (particles[i].life <= 0) {
                        particles.splice(i, 1);
                    }
                }

                requestAnimationFrame(animate);
            }

            animate();
        }

        // Initialize sparkle trail
        createSparkleTrail();
    </script>

    <!-- 9. Background Music Controller -->
    <script>
        (function() {
            const music = document.getElementById('bg-music');
            const toggle = document.getElementById('music-toggle');
            
            music.volume = 0.3; // Start at 30% volume

            function fadeIn(audio, duration) {
                audio.volume = 0;
                audio.play().catch(() => {});
                const step = 0.3 / (duration / 50);
                const fade = setInterval(() => {
                    if (audio.volume + step >= 0.3) {
                        audio.volume = 0.3;
                        clearInterval(fade);
                    } else {
                        audio.volume += step;
                    }
                }, 50);
            }

            function fadeOut(audio, duration) {
                const step = audio.volume / (duration / 50);
                const fade = setInterval(() => {
                    if (audio.volume - step <= 0) {
                        audio.volume = 0;
                        audio.pause();
                        clearInterval(fade);
                    } else {
                        audio.volume -= step;
                    }
                }, 50);
            }

            toggle.addEventListener('click', () => {
                if (music.paused) {
                    fadeIn(music, 800);
                    toggle.classList.add('playing');
                    toggle.title = 'Pause music';
                } else {
                    fadeOut(music, 600);
                    toggle.classList.remove('playing');
                    toggle.title = 'Play music';
                }
            });
        })();
    </script>
</body>
</html>